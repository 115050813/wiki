<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 1.5.4"><title>Source Code</title><link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"></head><body class="article toc2 toc-left"><div id="header"><div id="toolbar"><a href="https://github.com/jMonkeyEngine/wiki/edit/master/src/docs/asciidoc/jme3/advanced/sourcecode.adoc"><i class="fa fa-pencil-square" aria-hidden="true"></i></a><a href="https://github.com/jMonkeyEngine/wiki/new/master/src/docs/asciidoc/jme3/advanced/"><i class="fa fa-plus-square" aria-hidden="true"></i></a><input dir="auto" style="position: relative; vertical-align: top;" spellcheck="false" autocomplete="off" class="searchbox__input aa-input" id="doc-search" name="search" placeholder="Search in the doc" required="required" type="search"></div><h1>Source Code</h1><div class="details"><span class="author" id="author"></span><br><span id="revnumber">version ,</span> <span id="revdate">2016/03/17 20:48</span></div><div id="toc" class="toc2"><div id="toctitle">Table of Contents</div><ul class="sectlevel1"><li><a href="#how-to-control-any-scene-node-source-code">How to control any scene node source code</a></li><li><a href="#how-to-control-a-character-in-a-scene-source-code">How to control a character in a scene source code</a></li></ul></div></div><div id="content"><div class="sect1"><h2 id="how-to-control-any-scene-node-source-code">How to control any scene node source code</h2><div class="sectionbody"><div class="listingblock"><div class="title">RotatingControl.java</div>
<div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">mygame</span>;
<span class="keyword">import</span> <span class="include">com.jme3.renderer.RenderManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.renderer.ViewPort</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Spatial</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.control.AbstractControl</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.control.Control</span>;

<span class="comment">/** 
 * 
 * @author normenhansen 
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">RotatingControl</span> <span class="directive">extends</span> AbstractControl {<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span>

    <span class="directive">private</span> <span class="type">float</span> speed = <span class="integer">1</span>;
<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">protected</span> <span class="type">void</span> controlUpdate(<span class="type">float</span> tpf) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
      spatial.rotate(<span class="integer">0</span>, <span class="integer">0</span>, tpf * speed);<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }

    <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">protected</span> <span class="type">void</span> controlRender(RenderManager rm, ViewPort vp) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
      <span class="comment">//Only needed for rendering-related operations,       </span>
      <span class="comment">//not called when spatial is culled.   </span>
    }

<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> <span class="predefined-type">Control</span> cloneForSpatial(Spatial spatial) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
      RotatingControl control = <span class="keyword">new</span> RotatingControl();<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
      control.setSpeed(speed);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
      control.setSpatial(spatial);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
      <span class="keyword">return</span> control;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }

<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="comment">/**    
     * @return the speed    
     */</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> <span class="type">float</span> getSpeed() {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
      <span class="keyword">return</span> speed;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }

<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="comment">/**    
     * @param speed the speed to set    
     */</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> <span class="type">void</span> setSpeed(<span class="type">float</span> speed) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
      <span class="local-variable">this</span>.speed = speed;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }
}</code></pre></div></div></div></div>
<div class="sect1"><h2 id="how-to-control-a-character-in-a-scene-source-code">How to control a character in a scene source code</h2><div class="sectionbody"><div class="paragraph"><p>You can read about this code on the jMonkeyEngine forum thread, <a href="https://hub.jmonkeyengine.org/t/new-sdk-video-tutorial-latest-vol2/25185">New Sdk Video Tutorial (Latest:Vol2)</a>.</p></div>
<div class="listingblock"><div class="title">ConfigAppState.java</div>
<div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">mygame</span>;

<span class="keyword">import</span> <span class="include">com.jme3.app.Application</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.SimpleApplication</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.state.BaseAppState</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Node</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.SceneGraphVisitor</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Spatial</span>;
<span class="keyword">import</span> <span class="include">controls.QuixoteControl</span>;

<span class="comment">/** 
 * 
 * @author normenhansen 
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ConfigAppState</span> <span class="directive">extends</span> BaseAppState {

    <span class="directive">private</span> SimpleApplication app;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">private</span> QuixoteState state = QuixoteState.RELAXED;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">private</span> Spatial quixote;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">private</span> <span class="type">boolean</span> quixoteRunning = <span class="predefined-constant">false</span>;
<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> <span class="type">enum</span> QuixoteState {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        AGITATED, RELAXED, SLEEPING<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }

<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">protected</span> <span class="type">void</span> initialize(Application app) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="local-variable">this</span>.app = (SimpleApplication) app;<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        setQuixoteRunning(<span class="predefined-constant">true</span>);<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }

<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">protected</span> <span class="type">void</span> cleanup(Application app) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="comment">//TODO: clean up what you initialized in the initialize method,       </span>
        <span class="comment">//e.g. remove all spatials from rootNode   </span>
    }
<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="comment">//onEnable()/onDisable() can be used for managing things that should    </span>
    <span class="comment">//only exist while the state is enabled. Prime examples would be scene    </span>
    <span class="comment">//graph attachment or input listener attachment.   </span>
    <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">protected</span> <span class="type">void</span> onEnable() {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="comment">//Called when the state is fully enabled, ie: is attached and        </span>
        <span class="comment">//isEnabled() is true or when the setEnabled() status changes after the        </span>
        <span class="comment">//state is attached.   </span>
    }

<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">protected</span> <span class="type">void</span> onDisable() {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="comment">//Called when the state was previously enabled but is now disabled        </span>
        <span class="comment">//either because setEnabled(false) was called or the state is being        </span>
        <span class="comment">//cleaned up.   </span>
    }

<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> <span class="type">void</span> update(<span class="type">float</span> tpf) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="comment">//TODO: implement behavior during runtime   </span>
    }

<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="comment">/**    
     * @return the quixoteRunning    
     */</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> <span class="type">boolean</span> isQuixoteRunning() {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="keyword">return</span> quixoteRunning;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }

<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="comment">/**    
     * @param quixoteRunning the quixoteRunning to set    
     */</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> <span class="type">void</span> setQuixoteRunning(<span class="type">boolean</span> quixoteRunning) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="local-variable">this</span>.quixoteRunning = quixoteRunning;<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="keyword">if</span> (quixoteRunning) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            quixote = getApplication().getAssetManager().loadModel(
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Models/Quixote.j3o</span><span class="delimiter">&quot;</span></span>);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            applyQuixoteState(quixote, state);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            Node scene = (Node) app.getRootNode().getChild(<span class="string"><span class="delimiter">&quot;</span><span class="content">Scene</span><span class="delimiter">&quot;</span></span>);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            <span class="keyword">if</span> (scene != <span class="predefined-constant">null</span>) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                scene.attachChild(quixote);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            }<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        } <span class="keyword">else</span> {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            <span class="keyword">if</span> (quixote != <span class="predefined-constant">null</span>) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                quixote.removeFromParent();<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            }<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        }<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }

<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="comment">/**    
     * @return the state    
     */</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> QuixoteState getState() {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="keyword">return</span> state;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }

    <span class="comment">/**    
     * @param state the state to set    
     */</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> <span class="type">void</span> setState(QuixoteState state) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="local-variable">this</span>.state = state;<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        QuixoteState quxState = state;<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        app.getRootNode().depthFirstTraversal(<span class="keyword">new</span> SceneGraphVisitor() {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            <span class="directive">public</span> <span class="type">void</span> visit(Spatial spatial) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                applyQuixoteState(spatial, quxState);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            }<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        });<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span>

    <span class="directive">private</span> <span class="type">void</span> applyQuixoteState(Spatial spatial, QuixoteState state) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        QuixoteControl control = spatial.getControl(QuixoteControl.class);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            <span class="keyword">if</span> (control != <span class="predefined-constant">null</span>) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            <span class="keyword">switch</span> (state) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                <span class="keyword">case</span> AGITATED: <span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                    control.setSpeed(<span class="float">5.0f</span>);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                    <span class="keyword">break</span>;<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                <span class="keyword">case</span> RELAXED:<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                    control.setSpeed(<span class="float">1.0f</span>);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                    <span class="keyword">break</span>;<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                <span class="keyword">case</span> SLEEPING:<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                    control.setSpeed(<span class="float">0.0f</span>);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                    <span class="keyword">break</span>;<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            }<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        }<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }
}</code></pre></div></div>
<div class="listingblock"><div class="title">QuixoteControl.java</div>
<div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">mygame</span>;

<span class="keyword">import</span> <span class="include">com.jme3.math.Quaternion</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.Vector3f</span>;
<span class="keyword">import</span> <span class="include">com.jme3.renderer.RenderManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.renderer.ViewPort</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Node</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.SceneGraphVisitor</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Spatial</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.control.AbstractControl</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.control.Control</span>;
<span class="keyword">import</span> <span class="include">java.util.LinkedList</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="keyword">import</span> <span class="include">java.util.Random</span>;

<span class="comment">/** 
 * 
 * @author normenhansen 
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">QuixoteControl</span> <span class="directive">extends</span> AbstractControl {<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span>

    <span class="directive">private</span> Spatial myMill;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">private</span> <span class="type">float</span> speed = <span class="float">1.0f</span>;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Random</span> rnd = <span class="keyword">new</span> <span class="predefined-type">Random</span>(<span class="predefined-type">System</span>.currentTimeMillis());<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">private</span> <span class="directive">final</span> Quaternion lookRotation = <span class="keyword">new</span> Quaternion();
<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">protected</span> <span class="type">void</span> controlUpdate(<span class="type">float</span> tpf) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="keyword">if</span> (myMill == <span class="predefined-constant">null</span>) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            millers();<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        }<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        runToTheMills(tpf);<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }
<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">protected</span> <span class="type">void</span> controlRender(RenderManager rm, ViewPort vp) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="comment">//Only needed for rendering-related operations,       </span>
        <span class="comment">//not called when spatial is culled.   </span>
    }

<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> <span class="predefined-type">Control</span> cloneForSpatial(Spatial spatial) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        QuixoteControl control = <span class="keyword">new</span> QuixoteControl();<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
 <span class="error"> </span> <span class="error"> </span> <span class="error"> </span>  control.setSpeed(speed);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        control.setSpatial(spatial);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="keyword">return</span> control;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }

<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="directive">public</span> <span class="type">void</span> millers() {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        Node node = spatial.getParent();<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="keyword">if</span> (node != <span class="predefined-constant">null</span>) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            <span class="directive">final</span> <span class="predefined-type">List</span>&lt;Spatial&gt; mills = <span class="keyword">new</span> <span class="predefined-type">LinkedList</span>&lt;&gt;();<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            node.depthFirstTraversal(<span class="keyword">new</span> SceneGraphVisitor() { <span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                <span class="directive">public</span> <span class="type">void</span> visit(Spatial spatial) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                    <span class="keyword">if</span> (spatial.getName().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Models/RotatingMill.j3o</span><span class="delimiter">&quot;</span></span>)) {
                        mills.add(spatial);
                    }
                }<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            });<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            <span class="keyword">if</span> (mills.isEmpty()) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                <span class="keyword">return</span>;<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            }<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            <span class="type">int</span> no = (<span class="type">int</span>) ((mills.size() - <span class="integer">1</span>) * rnd.nextFloat());<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            myMill = mills.get(no);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        }
    }
<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> <span class="type">void</span> runToTheMills(<span class="type">float</span> tpf) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="keyword">if</span> (myMill != <span class="predefined-constant">null</span>) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            Vector3f aim = myMill.getWorldTranslation();<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            Vector3f dist = aim.subtract(spatial.getWorldTranslation());<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            <span class="keyword">if</span> (dist.length() &lt; <span class="integer">1</span>) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                myMill = <span class="predefined-constant">null</span>;<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            } <span class="keyword">else</span> {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                dist.normalizeLocal();<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                lookRotation.lookAt(dist, Vector3f.UNIT_Y);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                spatial.setLocalRotation(lookRotation);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                spatial.move(dist.multLocal(speed * tpf));<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            }<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        }<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }
<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="comment">/**    
     * @return the speed    
     */</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> <span class="type">float</span> getSpeed() {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="keyword">return</span> speed;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }
<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="comment">/**    
     * @param speed the speed to set    
     */</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
     <span class="directive">public</span> <span class="type">void</span> setSpeed(<span class="type">float</span> speed) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="local-variable">this</span>.speed = speed;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }
}</code></pre></div></div>
<div class="listingblock"><div class="title">TerrainTrackControl.java</div>
<div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">mygame</span>;

<span class="keyword">import</span> <span class="include">com.jme3.collision.CollisionResult</span>;
<span class="keyword">import</span> <span class="include">com.jme3.collision.CollisionResults</span>;
<span class="keyword">import</span> <span class="include">com.jme3.export.InputCapsule</span>;
<span class="keyword">import</span> <span class="include">com.jme3.export.JmeExporter</span>;
<span class="keyword">import</span> <span class="include">com.jme3.export.JmeImporter</span>;
<span class="keyword">import</span> <span class="include">com.jme3.export.OutputCapsule</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.Ray</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.Vector3f</span>;
<span class="keyword">import</span> <span class="include">com.jme3.renderer.RenderManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.renderer.ViewPort</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Spatial</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.control.AbstractControl</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.control.Control</span>;
<span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.util.Iterator</span>;

<span class="comment">/** 
 * 
 * @author normenhansen 
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TerrainTrackControl</span> <span class="directive">extends</span> AbstractControl {<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="comment">//Any local variables should be encapsulated by getters/setters so they   </span>
    <span class="comment">//appear in the SDK properties window and can be edited.   </span>
    <span class="comment">//Right-click a local variable to encapsulate it with getters and setters.   </span>
    <span class="directive">private</span> <span class="directive">final</span> Ray ray = <span class="keyword">new</span> Ray(Vector3f.ZERO.clone(), <span class="keyword">new</span> Vector3f(<span class="integer">0</span>, -<span class="integer">1</span>, <span class="integer">0</span>));<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">private</span> <span class="directive">final</span> Vector3f up = <span class="keyword">new</span> Vector3f(<span class="integer">0</span>, <span class="integer">50</span>, <span class="integer">0</span>);<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">private</span> <span class="directive">final</span> CollisionResults results = <span class="keyword">new</span> CollisionResults();<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">private</span> <span class="directive">final</span> <span class="type">float</span> offset = <span class="float">0.5f</span>;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">private</span> Spatial terrain;<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span>

    <span class="directive">public</span> TerrainTrackControl() {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span>

    }<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span>

    <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">protected</span> <span class="type">void</span> controlUpdate(<span class="type">float</span> tpf) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        terrain = spatial.getParent();<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="keyword">if</span> (terrain != <span class="predefined-constant">null</span>) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            ray.setOrigin(spatial.getWorldTranslation().add(up));<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            ray.setLimit(<span class="integer">100</span>);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            results.clear();<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            terrain.collideWith(ray, results);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            <span class="keyword">for</span> (<span class="predefined-type">Iterator</span>&lt;CollisionResult&gt; it = results.iterator(); it.hasNext(); ) {
                CollisionResult collisionResult = it.next();<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                <span class="keyword">if</span> (isTerrain(collisionResult.getGeometry()) ) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                    Vector3f loc = collisionResult.getContactPoint();<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                    spatial.setLocalTranslation(
                        spatial.getLocalTranslation().setY(loc.getY() * offset));
                    <span class="keyword">return</span>;<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                }<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            }<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        }<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span>

    <span class="directive">private</span> <span class="type">boolean</span> isTerrain(Spatial spat) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="keyword">while</span> (<span class="predefined-constant">true</span>) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            <span class="keyword">if</span> (spat == <span class="predefined-constant">null</span>) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                <span class="keyword">return</span> <span class="predefined-constant">false</span>;<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string"><span class="delimiter">&quot;</span><span class="content">terrain</span><span class="delimiter">&quot;</span></span>.equals(spat.getName())) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                <span class="keyword">return</span> <span class="predefined-constant">true</span>;<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            }<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            spat = spat.getParent();<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        }<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }
<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">protected</span> <span class="type">void</span> controlRender(RenderManager rm, ViewPort vp) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="comment">//Only needed for rendering-related operations,       </span>
        <span class="comment">//not called when spatial is culled.   </span>
    }
<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> <span class="predefined-type">Control</span> cloneForSpatial(Spatial spatial) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        TerrainTrackControl control = <span class="keyword">new</span> TerrainTrackControl();<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="comment">//TODO: copy parameters to new Control       </span>
        <span class="keyword">return</span> control;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }
<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> <span class="type">void</span> read(JmeImporter im) <span class="directive">throws</span> <span class="exception">IOException</span> {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="local-variable">super</span>.read(im);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        InputCapsule in = im.getCapsule(<span class="local-variable">this</span>);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="comment">//TODO: load properties of this Control, e.g.       </span>
        <span class="comment">//this.value = in.readFloat(&quot;name&quot;, defaultValue);   </span>
    }
<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> <span class="type">void</span> write(JmeExporter ex) <span class="directive">throws</span> <span class="exception">IOException</span> {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="local-variable">super</span>.write(ex);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        OutputCapsule out = ex.getCapsule(<span class="local-variable">this</span>);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="comment">//TODO: save properties of this Control, e.g.       </span>
        <span class="comment">//out.write(this.value, &quot;name&quot;, defaultValue);   </span>
    }
}</code></pre></div></div>
<div class="listingblock"><div class="title">AnimUpdateControl.java</div>
<div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">mygame</span>;

<span class="keyword">import</span> <span class="include">com.jme3.animation.AnimChannel</span>;
<span class="keyword">import</span> <span class="include">com.jme3.animation.AnimControl</span>;
<span class="keyword">import</span> <span class="include">com.jme3.export.InputCapsule</span>;
<span class="keyword">import</span> <span class="include">com.jme3.export.JmeExporter</span>;
<span class="keyword">import</span> <span class="include">com.jme3.export.JmeImporter</span>;
<span class="keyword">import</span> <span class="include">com.jme3.export.OutputCapsule</span>;
<span class="keyword">import</span> <span class="include">com.jme3.renderer.RenderManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.renderer.ViewPort</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Spatial</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.control.AbstractControl</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.control.Control</span>;
<span class="keyword">import</span> <span class="include">java.io.IOException</span>;

<span class="comment">/** 
 * 
 * @author normenhansen 
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AnimUpdateControl</span> <span class="directive">extends</span> AbstractControl {<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="comment">//Any local variables should be encapsulated by getters/setters so they   </span>
    <span class="comment">//appear in the SDK properties window and can be edited.   </span>
    <span class="comment">//Right-click a local variable to encapsulate it with getters and setters.   </span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> RUN_TOP = <span class="string"><span class="delimiter">&quot;</span><span class="content">RunTop</span><span class="delimiter">&quot;</span></span>;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> RUN_BASE = <span class="string"><span class="delimiter">&quot;</span><span class="content">RunBase</span><span class="delimiter">&quot;</span></span>;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> IDLE_TOP = <span class="string"><span class="delimiter">&quot;</span><span class="content">IdleTop</span><span class="delimiter">&quot;</span></span>;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> IDLE_BASE = <span class="string"><span class="delimiter">&quot;</span><span class="content">IdleBase</span><span class="delimiter">&quot;</span></span>;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">private</span> AnimControl animControl;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">private</span> AnimChannel torsoChannel;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">private</span> AnimChannel feetChannel;<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span>

    <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">protected</span> <span class="type">void</span> controlUpdate(<span class="type">float</span> tpf) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        QuixoteControl quixote = spatial.getControl(QuixoteControl.class);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="keyword">if</span> (quixote != <span class="predefined-constant">null</span> &amp;&amp; checkAnimControl()) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            <span class="keyword">if</span> (quixote.getSpeed() &gt; <span class="integer">0</span>) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                <span class="keyword">if</span> (!RUN_TOP.equals(torsoChannel.getAnimationName())) {
                    torsoChannel.setAnim(RUN_TOP);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                }<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            }<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            <span class="keyword">if</span> (!RUN_BASE.equals(feetChannel.getAnimationName())) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                feetChannel.setAnim(RUN_BASE);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            }<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        } <span class="keyword">else</span> {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            <span class="keyword">if</span> (!IDLE_TOP.equals(torsoChannel.getAnimationName())) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                torsoChannel.setAnim(IDLE_TOP);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            }<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            <span class="keyword">if</span> (!IDLE_BASE.equals(feetChannel.getAnimationName())) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                feetChannel.setAnim(IDLE_BASE);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            }<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        }<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="error"> </span><span class="error"> </span><span class="error"> </span>

    <span class="comment">/**    
     * Checks if the animControl is available and creates channels if it is.    
     */</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">private</span> <span class="type">boolean</span> checkAnimControl() {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        AnimControl control = spatial.getControl(AnimControl.class);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="keyword">if</span> (control != animControl) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            <span class="local-variable">this</span>.animControl = control;<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            <span class="keyword">if</span> (animControl != <span class="predefined-constant">null</span>) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                torsoChannel = animControl.createChannel();<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
                feetChannel = animControl.createChannel();<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
            }<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        }<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="keyword">return</span> animControl != <span class="predefined-constant">null</span>;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }
<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">protected</span> <span class="type">void</span> controlRender(RenderManager rm, ViewPort vp) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="comment">//Only needed for rendering-related operations,       </span>
        <span class="comment">//not called when spatial is culled.   </span>
    }

    <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> <span class="predefined-type">Control</span> cloneForSpatial(Spatial spatial) {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        AnimUpdateControl control = <span class="keyword">new</span> AnimUpdateControl();<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="comment">//TODO: copy parameters to new Control       </span>
        control.setSpatial(spatial);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="keyword">return</span> control;<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    }
<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> <span class="type">void</span> read(JmeImporter im) <span class="directive">throws</span> <span class="exception">IOException</span> {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="local-variable">super</span>.read(im);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        InputCapsule in = im.getCapsule(<span class="local-variable">this</span>);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="comment">//TODO: load properties of this Control, e.g.       </span>
        <span class="comment">//this.value = in.readFloat(&quot;name&quot;, defaultValue);   </span>
    }
<span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="annotation">@Override</span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
    <span class="directive">public</span> <span class="type">void</span> write(JmeExporter ex) <span class="directive">throws</span> <span class="exception">IOException</span> {<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="local-variable">super</span>.write(ex);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        OutputCapsule out = ex.getCapsule(<span class="local-variable">this</span>);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
        <span class="comment">//TODO: save properties of this Control, e.g.       </span>
        <span class="comment">//out.write(this.value, &quot;name&quot;, defaultValue);   </span>
    }
}</code></pre></div></div></div></div></div><div id="footer"><div id="footer-text">Version <br>Last updated 2017-06-16 23:03:30 UTC</div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script>docsearch({
  apiKey: 'a736b6d93de805e26ec2f49b55013fbd',
  indexName: 'jmonkeyengine',
  inputSelector: '#doc-search',
  debug: false // Set debug to true if you want to inspect the dropdown
});</script></body></html>